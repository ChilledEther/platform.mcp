---
phase: 02-platform-cli
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified: [internal/cli/cmd/generate.go, internal/templates/templates.yaml, internal/templates/loader.go]
autonomous: true
---

<objective>
Wire the CLI to the ProjectGenerator and externalize template configuration.

Purpose: Connect the CLI to the full scaffolding capabilities (Actions, Docker, Flux) and fulfill the deferred requirement for dynamic template configuration.
Output: A functional CLI that can generate multi-component scaffolds via a unified command.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-platform-cli/DISCOVERY.md
@.planning/phases/02-platform-cli/02-01-SUMMARY.md
@pkg/scaffold/project.go
@internal/templates/loader.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement ProjectGenerator Wiring</name>
  <files>internal/cli/cmd/generate.go</files>
  <action>
    Update the `RunE` function of the `generate` command:
    1. Instantiate `scaffold.NewProjectGenerator()`.
    2. Map CLI flags (`with-actions`, `with-docker`, `with-flux`) to `scaffold.Config`.
    3. Execute generation and handle I/O using the existing logic (directory creation, overwrite protection).
  </action>
  <verify>
    `go run cmd/platform/main.go generate --with-actions --with-docker --project-name my-test` generates both files.
  </verify>
  <done>
    CLI supports full multi-component generation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integration Testing</name>
  <files>internal/cli/cmd/generate_test.go</files>
  <action>
    Update/add tests in `generate_test.go` to verify:
    - Multi-flag generation (e.g., `--with-actions --with-docker`).
    - Flag mapping to `ProjectGenerator`.
    - Correct error handling for invalid configurations.
  </action>
  <verify>
    `go test ./internal/cli/cmd/...` passes.
  </verify>
  <done>
    Phase 2 implementation is verified.
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `go build ./cmd/platform`
- [ ] Comprehensive test suite passes.
</verification>

<success_criteria>
- [ ] CLI supports vertical slices (Actions + Docker + Flux).
- [ ] Template registry is externalized to YAML.
- [ ] All integration tests pass.
</success_criteria>

<output>
After completion, create `.planning/phases/02-platform-cli/02-02-SUMMARY.md`
</output>
